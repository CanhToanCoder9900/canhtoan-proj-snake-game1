<html>
  <link href="https://fonts.googleapis.com/css2?family=Piazzolla:ital,wght@1,900&display=swap" rel="stylesheet">

  <head>
    <title>test thử</title>
    <style>body {
      font-family: 'Piazzolla', serif;
      font-size: 14px;
      height: 100%;
    
      /* Center and scale the image nicely */
      background-size: cover;
           background-image: url(https://cdn.glitch.com/e33c65c0-dce5-46f6-a76a-0497e22bb1b5%2Fjh.jpg?v=1601553406369);
      }
    #board div{
       background-color: '#0b31ac';
        border: 1px solid rgb(0, 255, 234);
        box-sizing: border-box;
        display: inline-block;
        width: 24px;
        height: 24px;
    }
    #colorw {
      color: white;
    
    }
    #board {
      margin: auto;
      width: calc(26*24px);
    }
    
    #board .snake{
      background-color:#fff200 ;
    }
    
    #board .apple{
    background-color: red;
    }
    
    label {
      font-size:30px;
    }
    
    input[type=text]{
      font-size: 28px;
      padding: 5px;
    }</style>
  </head>

  <body onload = "initGame()" >

    <div id = "board">
    </div><br><br>
    <label id = "colorw"> Điểm Số: </label>

    <input type = "text" id = "score" readonly>
    <b1></b1>

  </body>

  <script> const khung_cua_tro_choi = [];
    const chieu_rong_cua_khung_ngan_cach = 26, chieu_dai_cua_khung_ngan_cach = 16;

    var Toa_do_ran_X;
    var Toa_do_ran_Y;
    var Chieu_dai_cua_ran;
    var Huong_di_chuyen;
    var Diem_so = 0;

    function initGame() {
        const thanh_phan_cua_bang = document.getElementById('board');

        for (var y = 0; y < chieu_dai_cua_khung_ngan_cach; ++y) {
            var row = [];
            for (var x = 0; x < chieu_rong_cua_khung_ngan_cach; ++x) {
                var cell = {};
                
                cell.element = document.createElement('div');
                thanh_phan_cua_bang.appendChild(cell.element);
                row.push(cell);
            }
            khung_cua_tro_choi.push(row);
        }

        bat_dau_tro_choi();
        var ret = lap_lai();
      if(ret == false)
        return;
    }
        
    function bat_dau_tro_choi() {
        Toa_do_ran_X = Math.floor(chieu_rong_cua_khung_ngan_cach / 2);
        Toa_do_ran_Y = Math.floor(chieu_dai_cua_khung_ngan_cach / 2);
        Chieu_dai_cua_ran = 3;
        Huong_di_chuyen = 'Lên';

        for (var y = 0; y < chieu_dai_cua_khung_ngan_cach; ++y) {
            for (var x = 0; x < chieu_rong_cua_khung_ngan_cach; ++x) {
                khung_cua_tro_choi[y][x].snake = 0;
              khung_cua_tro_choi[y][x].apple = 0;
            }
        }
        khung_cua_tro_choi[Toa_do_ran_Y][Toa_do_ran_X].snake = Chieu_dai_cua_ran;
      
      dat_qua_tao();
    }

     function lap_lai() {
        switch (Huong_di_chuyen) {
            case 'Lên':    Toa_do_ran_Y--; break;
            case 'Xuống':  Toa_do_ran_Y++; break;
            case 'Trái':  Toa_do_ran_X--; break;
            case 'Phải': Toa_do_ran_X++; break;
        }
        if (Toa_do_ran_X < 0 || Toa_do_ran_Y < 0 || Toa_do_ran_X >= chieu_rong_cua_khung_ngan_cach || Toa_do_ran_Y >= chieu_dai_cua_khung_ngan_cach) {
          var reset = confirm('Game Over. Bạn có muốn chơi lại không?');
          if(reset == true){
            bat_dau_tro_choi();
          }
          else {
            return;
          }
        }
        
      
      if(khung_cua_tro_choi[Toa_do_ran_Y][Toa_do_ran_X].snake == 1) {
        var reset = confirm('Game Over. Bạn có muốn chơi lại không?');
          if(reset == true){
            bat_dau_tro_choi();
          }
        else{
          return false;
        }
      }
      
      if(khung_cua_tro_choi[Toa_do_ran_Y][Toa_do_ran_X].apple === 1){
        Chieu_dai_cua_ran++;
        Diem_so++;
        document.getElementById("score").value = Diem_so;
        khung_cua_tro_choi[Toa_do_ran_Y][Toa_do_ran_X].apple = 0;
        dat_qua_tao();
      }
      
      khung_cua_tro_choi[Toa_do_ran_Y][Toa_do_ran_X].snake = Chieu_dai_cua_ran;
      
        for (var y = 0; y < chieu_dai_cua_khung_ngan_cach; ++y) {
            for (var x = 0; x < chieu_rong_cua_khung_ngan_cach; ++x) {
                var cell = khung_cua_tro_choi[y][x];

                if (cell.snake > 0) {
                    cell.element.className = 'snake';
                  cell.snake -= 1;
                }
              else if (cell.apple === 1){
                cell.element.className = 'apple';
              }
                else {
                    cell.element.className = '';
                }
            }
        }
        setTimeout(lap_lai, Chieu_dai_cua_ran<20? 270 : 220);
    }

    document.body.onkeydown = function() {
        switch (event.key) {
            case 'ArrowUp': 
            if(Huong_di_chuyen != 'Xuống')
            Huong_di_chuyen = 'Lên'; break;
            case 'ArrowDown': 
            if(Huong_di_chuyen != 'Lên')
            Huong_di_chuyen = 'Xuống'; break;
            case 'ArrowLeft': 
            if(Huong_di_chuyen != 'Phải')
            Huong_di_chuyen = 'Trái'; break;
            case 'ArrowRight': 
            if(Huong_di_chuyen != 'Trái')
            Huong_di_chuyen = 'Phải'; break;
            default: break;
        }
        event.preventDefault();
    }
    
    function dat_qua_tao() {
      var appleX = Math.floor(Math.random() * chieu_rong_cua_khung_ngan_cach);
      var appleY = Math.floor(Math.random() * chieu_dai_cua_khung_ngan_cach);
      
      for(var y = 0; y < chieu_dai_cua_khung_ngan_cach; y++) {
        for(var x = 0; x < chieu_rong_cua_khung_ngan_cach; x++) {
          if(khung_cua_tro_choi[y][x].snake == 0) {
            khung_cua_tro_choi[appleY][appleX].apple = 1;
            break;
          }
        }
      }
      
    }</script>
</html>
